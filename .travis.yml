sudo: false
language: ruby
bundler_args: --no-deployment

script:
  - bundle exec rake metadata
  - bundle exec rake syntax
  - bundle exec rake lint
  - bundle exec rake spec

matrix:
  fast_finish: true
  include:
  - rvm: 2.1.5
    env: PUPPET_VERSION="~> 3.7.5" DEPLOY="yes"
  - rvm: 1.9.3
    env: PUPPET_VERSION="~> 3.4.0"
  - rvm: 1.9.3
    env: PUPPET_VERSION="~> 3.0"

before_deploy:
  - bundle exec puppet module build

deploy:
  provider: releases
  api-key:
    secure: "R8Q/pW53GXC3fHVIe3fqhvweukdJNph0mtCV3vnMLj3Vrt8V33l8DgKvGfxrwh+bsd/v1lr01K5/rWijDsrWMd/8boAVcsJCIYwVS3C6dPxEb0lww5oThl1EHHM3/wM4FQLefbK8/KnTK8qWGSQmwLsX1M+Ehdy4QU9SfO28Ks4="
  file: "$(ls $TRAVIS_BUILD_DIR/pkg/s12v-blackfire-*.tar.gz | head -n 1)"
  skip_cleanup: true
  on:
    tags: true
    all_branches: true
    condition: $DEPLOY = yes
